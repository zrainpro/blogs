(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c080b63a"],{"488a":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"comment"},[a("h1",{staticClass:"manage-title"},[e._v("评论管理")]),a("div",{staticClass:"search"},[a("CreateForm",{attrs:{"label-width":"80px","data-source":e.searchForm},on:{onOk:e.handleOk}})],1),a("div",{staticClass:"operation"},[a("el-button",{attrs:{type:"success",plain:"",size:"small"},on:{click:function(t){return e.enabled(!0)}}},[e._v("批量启用")]),a("el-button",{attrs:{type:"warning",plain:"",size:"small"},on:{click:function(t){return e.enabled(!1)}}},[e._v("批量删除")]),a("el-button",{attrs:{type:"danger",plain:"",size:"small"},on:{click:e.deleteComment}},[e._v("彻底删除")])],1),a("el-table",{attrs:{data:e.lists},on:{"selection-change":function(t){e.selection=t}}},[a("el-table-column",{attrs:{type:"selection",width:"30"}}),a("el-table-column",{attrs:{label:"内容",prop:"content",width:"300","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"所属文章",prop:"article"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("a",{attrs:{href:"/article/"+l.article._id,target:"_blank"}},[e._v(e._s(l.article.title))])]}}])}),a("el-table-column",{attrs:{label:"昵称",prop:"nickname"}}),a("el-table-column",{attrs:{label:"电子邮箱",prop:"email"}}),a("el-table-column",{attrs:{label:"博客地址",prop:"disabled",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:t.row.blog,target:"_blank"}},[e._v(e._s(t.row.blog))])]}}])}),a("el-table-column",{attrs:{label:"点赞数",prop:"like",width:"80"}}),a("el-table-column",{attrs:{label:"点踩数",prop:"dislike",width:"80"}}),a("el-table-column",{attrs:{label:"创建时间",prop:"createTime",width:"100"}}),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("Reply",{attrs:{"self-user":e.user},on:{reply:function(t){return e.replay(t,l)}}}),a("el-button",{class:0===l.disabled?"red":"green",attrs:{type:"text"},on:{click:function(t){return e.enabled(0===l.disabled?1:0,[l._id])}}},[e._v(" "+e._s(0===l.disabled?"删除":"启用")+" ")]),a("el-button",{staticClass:"red",attrs:{type:"text"},on:{click:function(t){return e.deleteComment([l._id])}}},[e._v("彻底删除")])]}}])})],1),e.page.total>e.page.limit?a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.page.total},on:{"current-change":e.pageChange}})],1):e._e()],1)},n=[],i=a("5530"),o=(a("d81d"),a("c1df")),r=a.n(o),s=a("7b0d"),c=a("2f3e"),u={name:"manageComment",components:{CreateForm:s["a"],Reply:c["a"]},data:function(){return{lists:[],selection:[],page:{page:1,limit:10,total:0},searchForm:{main:[{type:"input",key:"keyword",label:"关键字"},{type:"select",key:"disabled",label:"状态",default:0,options:[{value:0,label:"正常"},{value:1,label:"回收站"},{value:2,label:"所有"}]},{type:"searchSelect",key:"article",label:"所属文章",callback:this.getArticleData}]},user:{}}},created:function(){this.user=JSON.parse(localStorage.getItem("dXNlcg=="))},mounted:function(){this.getData()},methods:{getArticleData:function(e,t){this.apiPost("/api/article/list/all",{keyword:e}).then((function(e){200===e.code&&t(e.data.map((function(e){return{value:e._id,label:e.title}})))}))},getData:function(){var e=this;this.apiPost("/api/comment/list",this.page).then((function(t){200===t.code&&(e.lists=t.data.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{createTime:r()(e.createTime).format("YYYY-MM-DD HH:mm:ss")})})),e.page.total=t.total)}))},pageChange:function(e){this.page.page=e,this.getData()},handleOk:function(e){this.page=Object(i["a"])(Object(i["a"])({},this.page),e),this.getData()},enabled:function(e,t){var a=this;this.selection.length||t?this.$confirm("如该评论有回复则回复会一同被删除或者启用哦!").then((function(){a.apiPost("/api/comment/enabled",{comments:t||a.selection.map((function(e){return e._id})),code:e?0:1}).then((function(e){200===e.code&&(a.$message.success("操作成功"),setTimeout(a.getData,100))}))})):this.$message.warning("请先选择要操作的评论哦!")},deleteComment:function(e){var t=this;this.$confirm("确定彻底删除嘛!彻底删除之后无法恢复!\n如果该评论有回复,则相关的回复也会一并删除, 请谨慎操作!").then((function(){t.apiPost("/api/comment/delete",e||t.selection.map((function(e){return e._id}))).then((function(e){200===e.code&&(t.$message.success("删除成功"),setTimeout(t.getData,100))}))}))},replay:function(e,t){var a=this,l=JSON.parse(localStorage.getItem("dXNlcg=="));this.apiPost("/api/comment/create",{article:t.article._id,nickname:l.nickname+"（博主）",avatar:l.avatar,email:l.email,blog:location.origin,content:e.content,pid:t._id,rootPid:t.rootPid}).then((function(e){200===e.code&&(a.$message.success("评论成功!"),a.getData())}))}}},m=u,p=(a("7750"),a("2877")),f=Object(p["a"])(m,l,n,!1,null,"9112a0fa",null);t["default"]=f.exports},7750:function(e,t,a){"use strict";a("c658")},"7b0d":function(e,t,a){"use strict";var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":e.labelWidth,inline:e.inline}},[e._l(e.dataSource.main,(function(t,l){return a("el-form-item",{key:l,attrs:{label:t.label,prop:t.key}},[a("FormItem",{ref:"mainForm",refInFor:!0,attrs:{item:t,form:e.form}})],1)})),a("el-form-item",[e.showOk?a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:e.handleOk}},[e._v(e._s(e.okText))]):e._e(),e.showReset?a("el-button",{attrs:{type:"warning",plain:"",size:"small"},on:{click:e.resetData}},[e._v(e._s(e.resetText))]):e._e(),e._t("btn")],2),e.dataSource.more?a("div",e._l(e.dataSource.more||[],(function(t,l){return a("el-form-item",{key:l,attrs:{label:t.label,prop:t.key}},[a("FormItem",{ref:"moreForm",refInFor:!0,attrs:{item:t,form:e.form}})],1)})),1):e._e()],2)},n=[],i=a("2909"),o=(a("d3b7"),a("159b"),a("99af"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return"input"===e.item.type?a("el-input",{attrs:{size:"small",disabled:e.item.disabled,type:e.item.inputType||"text",placeholder:e.item.placeholder},model:{value:e.form[e.item.key],callback:function(t){e.$set(e.form,e.item.key,t)},expression:"form[item.key]"}}):"select"===e.item.type?a("el-select",{attrs:{size:"small",multiple:e.item.multiple,clearable:e.item.clearable||!1,"multiple-limit":e.item.limit,placeholder:e.item.placeholder,filterable:e.item.filterable},model:{value:e.form[e.item.key],callback:function(t){e.$set(e.form,e.item.key,t)},expression:"form[item.key]"}},e._l(e.item.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):"cascader"===e.item.type?a("el-cascader",{attrs:{size:"small",options:e.item.options,placeholder:e.item.placeholder,clearable:e.item.clearable,filterable:e.item.filterable,props:{checkStrictly:!0}},model:{value:e.form[e.item.key],callback:function(t){e.$set(e.form,e.item.key,t)},expression:"form[item.key]"}}):"searchSelect"===e.item.type?a("el-autocomplete",{attrs:{size:"small","value-key":e.displayAutoCompleteKey,"fetch-suggestions":e.querySearch,placeholder:"请输入内容"},on:{select:function(t){e.form[e.item.key]=t.value}},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.item;return[a("span",[e._v(e._s(l.label))])]}}]),model:{value:e.autoComplete,callback:function(t){e.autoComplete=t},expression:"autoComplete"}}):e._e()}),r=[],s={name:"FormItem",props:{item:{type:Object,default:function(){return{}}},form:{type:Object,default:function(){return{}}},displayAutoCompleteKey:{type:String,default:"label"}},data:function(){return{autoComplete:""}},methods:{querySearch:function(e,t){this.item.callback&&this.item.callback(e,t)},reset:function(){this.autoComplete=""}}},c=s,u=a("2877"),m=Object(u["a"])(c,o,r,!1,null,"abc87b5e",null),p=m.exports,f={name:"CreateForm",components:{FormItem:p},props:{dataSource:{type:Object,default:function(){return{main:[],more:[]}}},labelWidth:{type:String,default:"100px"},rules:{type:Object,default:function(){return{}}},inline:{type:Boolean,default:!0},showOk:{type:Boolean,default:!0},showReset:{type:Boolean,default:!0},okText:{type:String,default:"搜索"},resetText:{type:String,default:"重置"}},data:function(){return{form:{}}},mounted:function(){this.setDefault()},methods:{handleOk:function(){var e=this;this.getData().then((function(t){e.$emit("onOk",t)}))},getData:function(){var e=this;return new Promise((function(t,a){e.$refs.form.validate((function(l){l?t(JSON.parse(JSON.stringify(e.form))):a(new Error("请填写完整"))}))}))},resetData:function(){this.$refs.form.resetFields(),(this.$refs.mainForm||[]).forEach((function(e){return e.reset()})),(this.$refs.moreForm||[]).forEach((function(e){return e.reset()})),this.setDefault()},setDefault:function(){var e=this;[].concat(Object(i["a"])(this.dataSource.main||[]),Object(i["a"])(this.dataSource.more||[])).forEach((function(t){"undefined"!==typeof t.default&&e.$set(e.form,t.key,t.default)}))}}},d=f,b=Object(u["a"])(d,l,n,!1,null,"1010fa3a",null);t["a"]=b.exports},c658:function(e,t,a){}}]);